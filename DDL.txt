create database lancamentos_db;

use lancamentos_db; 

create table estados(sigla varchar(2) primary key not null, nome varchar (255) not null unique) engine=InnoDB default charset=utf8;

create table cidades(id bigint not null primary key auto_increment, nome varchar(255) not null unique, estado_sigla varchar(2) not null)Engine=InnoDB default charset=utf8;
alter table cidades add constraint fk_estado_sigla foreign key(estado_sigla) references estados(sigla);

create table pessoas(id bigint primary key auto_increment, nome varchar(255) not null, ativo tinyint(4) not null)Engine=InnoDB default charset=utf8;

create table contatos(id bigint primary key auto_increment,nome varchar(255) not null, email varchar(255) not null unique,telefone varchar(14) not null, pessoa_id bigint not null, foreign key(pessoa_id) references pessoas(id))engine=InnoDB charset=utf8;
alter table contatos add constraint fk_pessoa_id foreign key(pessoa_id) references pessoas(id) on delete cascade;

create table enderecos(logradouro varchar(255) not null, numero varchar (255) not null, complemento varchar (255) not null, bairro varchar (255) not null, cep varchar(9) not null, pessoa_id bigint primary key not null, cidade_id bigint  not null, foreign key (pessoa_id) references pessoas(id),foreign key (cidade_id) references cidades(id))engine=InnoDB charset=utf8;

create table categorias (id bigint primary key auto_increment, descricao varchar(255) not null)engine=InnoDB charset=utf8;

create table lancamentos(id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,descricao VARCHAR (255) NOT NULL, dt_vencimento DATE NOT NULL, dt_pagamento DATE, valor DECIMAL(10,2) UNSIGNED NOT NULL, observacao TEXT, tipo ENUM('RECEITA','DESPESA') NOT NULL, pessoa_id BIGINT NOT NULL, categoria_id BIGINT NOT NULL, FOREIGN KEY (pessoa_id) REFERENCES pessoas(id), FOREIGN KEY (categoria_id) REFERENCES categorias(id)) Engine=Innodb default charset=utf8;
ALTER TABLE lancamentos ADD CONSTRAINT fk_lancamentos_pessoas FOREIGN KEY (pessoa_id) REFERENCES pessoas(id) ON CASCADE DELETE;
ALTER TABLE lancamentos ADD CONSTRAINT fk_lancamentos_categorias FOREIGN KEY (categoria_id) REFERENCES categorias(id);
